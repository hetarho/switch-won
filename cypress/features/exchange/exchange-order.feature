# language: ko
Feature: 환전 견적 및 실행
  로그인한 사용자가 환전 견적을 확인하고 환전을 실행할 수 있다

  Background:
    Given 사용자가 로그인되어 있다
    And 환전 페이지에 접속한다
    And 지갑에 KRW "1,000,000"이 있다
    And 현재 환율은 "1,300.00"이다

  Scenario: 환전 견적 조회
    When 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    Then 환전 견적이 표시된다
    And 받을 금액이 표시된다
    And 적용된 환율이 표시된다

  Scenario: 환전 금액 입력 시 실시간 견적 업데이트
    When 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    Then 환전 견적 API가 호출된다
    When 환전 금액을 "200,000"으로 변경한다
    Then 환전 견적 API가 다시 호출된다
    And 새로운 견적이 표시된다

  Scenario: 잔액 부족으로 환전 불가
    When 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "2,000,000"을 입력한다
    Then 에러 메시지 "지갑 잔액이 부족합니다"가 표시된다
    And "환전하기" 버튼이 비활성화된다

  Scenario: 최소 금액 미만으로 환전 시도
    When 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100"을 입력한다
    Then 에러 메시지 "최소 환전 금액은 1,000원입니다"가 표시된다
    And "환전하기" 버튼이 비활성화된다

  Scenario: 환전 실행 성공
    Given 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    When "환전하기" 버튼을 클릭한다
    Then 성공 메시지 "환전이 완료되었습니다"가 표시된다
    And 지갑 잔액이 자동으로 갱신된다
    And 입력 필드가 초기화된다

  Scenario: 환전 실행 중 로딩 상태
    Given 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    When "환전하기" 버튼을 클릭한다
    Then 로딩 인디케이터가 표시된다
    And "환전하기" 버튼이 비활성화된다

  Scenario: 환전 실행 실패
    Given 환전 API가 에러를 반환하도록 설정한다
    And 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    When "환전하기" 버튼을 클릭한다
    Then 에러 메시지 "환전 처리 중 오류가 발생했습니다"가 표시된다
    And 지갑 잔액은 변경되지 않는다

  Scenario: 환전 성공 후 내역 보기
    Given 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    When "환전하기" 버튼을 클릭한다
    Then 성공 메시지에 "내역 보기" 링크가 표시된다
    When "내역 보기" 링크를 클릭한다
    Then 환전 내역 페이지로 이동한다

  Scenario: 통화 선택 변경
    When 출발 통화로 "USD"를 선택한다
    And 도착 통화로 "KRW"를 선택한다
    And 환전 금액 "100"을 입력한다
    Then USD to KRW 환율로 견적이 계산된다
    And 받을 금액이 KRW로 표시된다

  Scenario: 수수료 정보 표시
    Given 서버에서 수수료 정보를 제공한다
    When 출발 통화로 "KRW"를 선택한다
    And 도착 통화로 "USD"를 선택한다
    And 환전 금액 "100,000"을 입력한다
    Then 수수료 정보가 표시된다
    And 수수료를 차감한 최종 금액이 표시된다

